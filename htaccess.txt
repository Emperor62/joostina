##
# @version $Id: htaccess.txt 5973 2006-12-11 01:26:33Z robs $
# @package Joostina
# @copyright Авторские права (C) 2007 Joostina Team.
# @localized Авторские права (C) 2005 Joom.Ru - Русский дом Joomla!
# @copyright Авторские права (C) 2005 Open Source Matters. Все права защищены.
# @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
# Joomla! - свободное программное обеспечение.
# @translator Sourpuss (Sourpuss@mail.ru)
# @upd doctorgrif (artem.grafov@gmail.com)
##
# ----======= ВНИМАНИЕ!!! ОБЯЗАТЕЛЬНО УСТАНОВИТЕ CHMOD 644 НА ЭТОТ ФАЙЛ  =======---- 
# Установка кодировки сайта по умолчанию. При необходимости, закомментируйте.
AddDefaultCharset WINDOWS-1251
# Следующие строки - попытка исправить настройки PHP для полного соответствия системным требованиям Joomla.
# Раскомментируйте (символ комментария - #) нужные строки, если настройки вашего хоста не соответствуют рекомендациям
# системных требований Joomla.

# При возникновении 500 ошибки сервера, закомментируйте строку, вызывающую ошибку, или все строки с php_value.
# php_value register_globals 0
# php_value display_errors 0
# php_value file_uploads 1
# php_value magic_quotes_gpc 1
# php_value magic_quotes_runtime 0

# Пример явного указания каталога для записи сессий:
# Для Windows - c:/temp
# для UNIX  - /tmp
# Указанные каталоги должны физически существовать и быть доступны для записи

# При необходимости, раскомментируйте строку ниже этой
# php_value session.save_path c:/temp

##
# ПРОЧТИТЕ ПОЛНОСТЬЮ, ЕСЛИ БУДЕТЕ ИСПОЛЬЗОВАТЬ ЭТОТ ФАЙЛ
# Строка ниже этого раздела: 'Options +FollowSymLinks' может вызвать проблему при некоторых конфигурациях сервера. Она необходима для # использования модуля Apache mod_rewrite, но может быть уже настроена администратором вашего сервера и изменение этого параметра в
# .htaccess может быть запрещено.
# Если эта директива вызывает ошибку сервера, то закомментируйте строку (добавьте символ # в начало строки), перезагрузите в браузере # сайт и протестируйте работу SEF-ссылок. Если они работают, то вам не надо ничего менять здесь, т.к. всё уже настроено 
# администратором сервера.
# Используйте только один из двух разделов SEF, которые находятся ниже. Строки, которые можно раскомментировать (и использовать) 
# имеют только один #.  Строки с двумя символами # раскомментировать не надо.
# В разделах, которые вы не используете, все строки должны начинаться с символа #
# Для стандартного SEF, используйте раздел стандартного SEF. Вы можете закомментировать все строки с RewriteCond и уменьшить загрузку # сервера, если у вас в корне нет каталогов с названиями 'component' или 'content'
# Если вы используете сторонние компоненты SEF или Core SEF, то раскомментируйте все строки в разделе 'SEF сторонних разработчиков 
# или Core SEF'
##

## РЕШЕНИЕ ПРОБЛЕМЫ С НЕРАБОТАЮЩИМИ URL КОМПОНЕНТОВ ##
# СПЕЦИАЛЬНОЕ ПРИМЕЧАНИЕ ДЛЯ ПОЛЬЗОВАТЕЛЕЙ SMF, ИСПОЛЬЗУЮЩИХ МОСТ ИНТЕГРАЦИИ
# ИЛИ ДЛЯ ТЕХ СЛУЧАЕВ, КОГДА НЕ РАБОТАЮТ URL КОМПОНЕНТОВ
# В обоих разделах 'Стандартного SEF', и 'SEF сторонних разработчиков или Core SEF' строка:
# RewriteCond %{REQUEST_URI} ^(/component/option,com) [NC,OR] ##опционально - смотрите примечания##
# может быть раскомментирована.  Если ваша Joomla/Mambo работает в подкаталоге, то в эту строку можно вставить название подкаталога.
# Например, если ваша Joomla/Mambo находится в подкаталоге '/test/', то измените:
# RewriteCond %{REQUEST_URI} ^(/component/option,com) [NC,OR] ##опционально - смотрите примечания##
# на:
# RewriteCond %{REQUEST_URI} ^(/test/component/option,com) [NC,OR] ##опционально - смотрите примечания##
##

<Files ~ "^\.(htaccess|htpasswd)$">
deny from all
</Files>

##  Может быть закомментировано, если вызывает ошибку сервера. Смотрите примечания выше.
Options Indexes
DirectoryIndex index.php
# order deny,allow
Options +FollowSymLinks +Indexes -MultiViews

AddType "application/x-rar-compressed" .rar
# AddType "image/x-icon" .ico

## Начало страниц ошибок
# ErrorDocument 400 400.html
# ErrorDocument 401 401html
# ErrorDocument 402 402.html
# ErrorDocument 403 403.html
# 404 ошибка (404 Not found) - страницу 404 создаем, публикуем в меню, но не выводим (снимаем с публикации), ссылку копируем.
# ErrorDocument 404 /index.php?option=com_content&task=view&id=18 
# По аналогии можно создать страницы для других ошибок (400, 403, 500, etc.)
# ErrorDocument 405 405.html
# ErrorDocument 406 406.html
# ErrorDocument 407 407.html
# ErrorDocument 408 408.html
# ErrorDocument 409 409.html
# ErrorDocument 410 410.html
# ErrorDocument 411 411.html
# ErrorDocument 412 412.html
# ErrorDocument 413 413.html
# ErrorDocument 414 414.html
# ErrorDocument 500 500.html
# ErrorDocument 501 501.html
# ErrorDocument 502 502.html
# ErrorDocument 503 503.html
# ErrorDocument 504 504.html
# ErrorDocument 505 505.html

# Включение mod_rewrite
RewriteEngine On

## Начало раздела стандартного SEF
# Используйте эту секцию ТОЛЬКО для работы встроенного SEF Joomla.
# ВСЕ (RewriteCond) строки в этой секции необходимы только если на вашем сервере имеются каталоги с названиями 'content' или
# 'component'/. Если каталоги с такими названиями отсутствуют, то закомментируйте эти строки.
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# RewriteCond %{REQUEST_URI} ^(/component/option,com) [NC,OR] ##опционально - смотрите примечания##
RewriteCond %{REQUEST_URI} (/|\.htm|\.php|\.html|/[^.]*)$ [NC]
RewriteRule ^(view/|content/|component/) index.php
## Конец раздела стандартного SEF

## Начало раздела SEF сторонних разработчиков или Core SEF
# Используйте этот раздел, если вы используете SEF-расширения типа OpenSEF, 404_SEF, 404SEFx, JoomSEF, SEF Advance и т.д.
# RewriteCond %{REQUEST_URI} ^(/component/option,com) [NC,OR] ##опционально - смотрите примечания##
# RewriteCond %{REQUEST_URI} (/|\.htm|\.php|\.html|/[^.]*)$  [NC]
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule (.*) index.php
## Конец раздела SEF сторонних разработчиков или Core SEF

# 503 ошибка (503 Service Temporarily Unavailable) - дополнительно для самостоятельного изучения
# Отсылаем 503 ошибку роботам (перечмслены только Google роботы, остальные добавляются по аналогии,
# список HTTP_USER_AGENT роботов спрашивать у www.google.com)
# RewriteCond %{HTTP_USER_AGENT} ^.*(Googlebot|Googlebot|Mediapartners|Adsbot|Feedfetcher)-?(Google|Image)? [NC]
# RewriteCond %{REQUEST_URI} !^/offline\.php [NC]
# RewriteRule .* /offline.php
# Людям вместо 503 страницу об ошибке - 404
# RewriteCond %{REMOTE_HOST} !^XXX\.XXX\.XXX\.XXX
# RewriteCond %{REQUEST_URI} !^/templates/404\.php [NC]
# Страницу 404 мы уже задали выше (line 71), вот ее родимую и отдаем электорату
# RewriteRule .* /index.php?option=com_content&task=view&id=18 [R=302,L]
## Конец страниц ошибок

## doctorgrif: (на всякий случай) Редирект с FeedBurner для Google AdSence - заворачивает трафик на ваш сайт
# RewriteCond %{HTTP_USER_AGENT} !FeedBurner
# RewriteRule ^index.php?option=com_rss&id=1&lang=ru$ http://feeds.feedburner.com/your_rss [R,L] 
# Sic!: Ссылку на ленту вносим с index.php в начале (!) и в конце с $ (!) (прим.: index.php?option=com_rss&id=1&lang=ru$) - смените на ваш адрес rss фида; your_rss - # адрес фида (окончание) в feedburner (прим.: http://feeds.feedburner.com/hospsurg/DTON)
# RewriteRule ^index\.xml$ http://feeds.feedburner.com/your_rss [R,L]
## Конец

## Начало - Правила обработки запросов для блокировки распространенных эксплоитов
# If you experience problems on your site block out the operations listed below.
# This attempts to block the most common type of exploit `attempts` to Joomla!
# Block out any script trying to set a mosConfig value through the URL
RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
# Block out any script trying to base64_encode crap to send via URL
RewriteCond %{QUERY_STRING} base64_encode.*\(.*\) [OR]
# Block out any script that includes a <script> tag in URL
RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
# Block out any script trying to set a PHP GLOBALS variable via URL
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
# Block out any script trying to modify a _REQUEST variable via URL
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
# Send all blocked request to homepage with 403 Forbidden error!
RewriteRule ^(.*)$ index.php [F,L]
## Конец - Правила обработки (Rewrite rules) для блокировки распространенных эксплоитов

## doctorgrif: Блокировка сетевых вирусов и сканеров
redirect /_vti_bin http://www.microsoft.com
redirect /scripts http://www.microsoft.com
redirect /MSADC http://www.microsoft.com
redirect /c http://www.microsoft.com
redirect /d http://www.microsoft.com
redirect /_mem_bin http://www.microsoft.com
redirect /msadc http://www.microsoft.com
RedirectMatch (.*)\cmd.exe$ http://www.microsoft.com$1
## Конец

# Раскомментируйте следующую строку, если URL вашего web-сервера не связаны напрямую с физическими путями файлов.
# Обновите Ваш каталог Joomla (используйте "/" для обозначения корня сервера)
# RewriteBase /

<FilesMatch "\.(js|css)$">
SetOutputFilter DEFLATE
</FilesMatch>

## Для Apache 1.* - если у вас эта версия - расскомментируйте, закомментировав правила для Apache 2.*
FileETag MTime Size
Header unset Pragma
FileETag None
Header unset ETag
<FilesMatch "\.(pdf|flv|jpg|jpeg|png|gif|js|css|swf|flv|doc|xls|zip|rar|tar|gz|tgz|7z)$">
Header set Cache-Control "max-age=290304000, public"
Header unset Last-Modified
</FilesMatch>
<FilesMatch "\.(ico)$">
Header set Cache-Control "max-age=290304000, public"
Header unset Last-Modified
</FilesMatch>
<FilesMatch "\.(php|html|htm|xml)$">
Header set Cache-Control "max-age=3600, public"
</FilesMatch>

## Для Apache 2.* - если у вас эта версия - расскомментируйте правила ниже (до вызова mod_rewrite.c), закомментировав правила для Apache 1.*
# <ifmodule mod_expires.c>
# <filesmatch ".(ico|jpg|gif|png|css|js)$">
# ExpiresActive on
# ExpiresDefault "access plus 1 year"
# </filesmatch>
# </ifmodule>

# <IfModule mod_headers.c>
# <FilesMatch "\.(ico|jpeg|jpg|png|gif|swf)$">
# Header set Cache-Control "max-age=2592000, public"
# </FilesMatch>
# <FilesMatch "\.(css)$">
# Header set Cache-Control "max-age=2592000, public"
# </FilesMatch>
# <FilesMatch "\.(js)$">
# Header set Cache-Control "max-age=2592000, private"
# </FilesMatch>
# <FilesMatch "\.(x?html?)$">
# Header set Cache-Control "max-age=3600, private, must-revalidate"
# </FilesMatch>
# </IfModule>
# <ifModule mod_headers.c>
# <filesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf)$">
# Header unset ETag
# FileETag None
# </filesMatch>
# </ifModule>
# <ifModule mod_headers.c>
# Header unset Last-Modified
# </ifModule>

# <IfModule mod_expires.c>
# ExpiresActive On
# ExpiresDefault "access plus 3600 seconds"
# ExpiresByType image/x-icon "access plus 1 year"
# ExpiresByType image/jpeg "access plus 1 year"
# ExpiresByType image/png "access plus 1 year"
# ExpiresByType image/gif "access plus 1 year"
# ExpiresByType application/x-shockwave-flash "access plus 1 year"
# ExpiresByType text/css "access plus 604800 seconds"
# ExpiresByType text/javascript "access plus 1 year"
# ExpiresByType application/x-javascript "access plus 1 year"
# ExpiresByType text/html "access plus 3600 seconds"
# ExpiresByType application/xhtml+xml "access plus 3600 seconds"
# </IfModule>

## doctorgrif: сжатие css и js файлов на сервере и корректная выдача их затем клиенту (опционально)
# <IfModule mod_rewrite.c>
# RewriteEngine On
# AddEncoding gzip .gz
# RewriteCond %{HTTP:Accept-encoding} !gzip [OR]
# RewriteCond %{HTTP_USER_AGENT} Safari [OR]
# RewriteCond %{HTTP_USER_AGENT} Konqueror
# RewriteRule ^(.*)\.gz(\?.+)?$ $1 [QSA,L] 
# К статичным ресурсам можно добавлять уникальные GET-строки, чтобы перегружать кеш на клиенте
# (если ресурс поменялся, то обновить его в кеше, иначе клиенты видят старую версию) - например, foo.css.gz?v1234.
# </IfModule>
# <IfModule mod_headers.c>
# Header append Vary User-Agent
# <FilesMatch .*\.js.gz$>
# ForceType text/javascript
# Header set Content-Encoding: gzip
# Header set Cache-control: private
# </FilesMatch>
# <FilesMatch .*\.css.gz$>
# ForceType text/css
# Header set Content-Encoding: gzip
# Header set Cache-control: private
# </FilesMatch>
# </IfModule>
## Конец